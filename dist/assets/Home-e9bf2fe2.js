import{j as N,k as e,ac as W}from"./index-38ac4596.js";import{k as G,m as J,j as n,i as V,n as K,o as Q,D as Y,p as X,q as Z,r as ee,S,s as se,t as le,v as ae,w as ie,C as H,d as A,L,x as M,N as T,P as z,M as E,y as t,A as g,z as R,E as U,f as $,F as O,G as B,U as q,e as te,H as ne,I as re,J as oe}from"./App-d0c1a583.js";function ce(){var c,d,m;const a=(c=location.search.match(/\?(\w+)=.*/))==null?void 0:c[0].split("?")[1].split("&")[0].split("=")[1],f=(d=location.search.match(/\?(\w+)=.*/))==null?void 0:d[0].split("?")[1].split("&")[1].split("=")[1],r=(m=location.search.match(/\?(\w+)=.*/))==null?void 0:m[0].split("?")[1].split("&")[2].split("=")[1].split("+").join(" ");return G({queryKey:["listings"],queryFn:async({pageParam:x})=>await J.get(`/api/listings/${x}`,{params:{minPrice:a,maxPrice:f,serviceType:r}}),getNextPageParam:(x,i)=>i.length+1,initialPageParam:1,enabled:n.currentUser!=null&&localStorage.getItem("token")!=null,refetchOnWindowFocus:!1,refetchOnMount:!1})}V.register();K.register();const p=new oe({cloud:{cloudName:"dop5kqpod"}});function xe(){var b;const{data:a,fetchNextPage:f,error:r,isPending:c,isFetchingNextPage:d}=ce(),{ref:m,isIntersecting:x}=Q({threshold:1});N.useEffect(()=>{document.title="IGotYou"},[]);const i=N.useMemo(()=>a==null?void 0:a.pages.flatMap(s=>s.data.listings.filter((o,u,h)=>h.indexOf(o)==u)),[a==null?void 0:a.pages]);return N.useEffect(()=>{r||x&&f()}),e.jsxs(e.Fragment,{children:[!((b=n.currentUser)!=null&&b.emailVerified)&&e.jsx(Y,{defaultOpen:sessionStorage.getItem("checked")!=="true",children:e.jsxs(X,{className:"p-0",children:[e.jsx(Z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{color:"orange",width:25,height:25}),e.jsx(ee,{className:"text-base font-semibold",children:"Some features are disabled!"})]})}),e.jsx(S,{}),e.jsx(se,{children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("span",{className:"text-sm ",children:["We trust you are doing well. To bolster the"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"security"})," ","and"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"reliability"})," ","of our platform, we seek your cooperation in verifying your email address. This verification is essential before you can"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"access certain features"})," ","on our website."]}),e.jsx("span",{className:"text-sm  ",children:"We appreciate your collaboration in maintaining the security and trustworthiness of our platform. Anticipating your verified email and the opportunity to see your contributions soon!"})]})})}),e.jsx(S,{}),e.jsxs("div",{className:"m-2 ml-auto flex w-max items-center justify-center gap-2 p-2",children:[e.jsx(le,{htmlFor:"checkbox",className:"text-xs font-medium",children:"Don't show this again"}),e.jsx(ae,{className:"rounded-full",onCheckedChange:s=>sessionStorage.setItem("checked",JSON.stringify(s)),id:"checkbox"})]})]})}),e.jsxs("section",{className:"mt-2 px-8",children:[e.jsx(ie,{}),c?e.jsx("div",{className:"mx-auto mt-32 w-max",children:e.jsx("l-pulsar",{size:"50",speed:"1.75",color:"gray"})}):i&&i.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-4 gap-4 max-lg:grid-cols-3 max-md:grid-cols-2 max-sm:grid-cols-1",children:i==null?void 0:i.map((s,o)=>{var u,h,w,y,v,_,P,I,D,C,k,F;return i.length==o+1?e.jsxs(H,{ref:m,className:"w-full overflow-hidden border-none shadow-none",children:[e.jsx(A,{className:"flex flex-col gap-1 p-0",children:e.jsx(L,{to:`${((u=n.currentUser)==null?void 0:u.uid)===((h=s.host)==null?void 0:h.uid)?`/hosting-listings/edit/${s._id}`:`/listings/show/${s._id}`} `,className:"mt-2",replace:!0,children:e.jsx(M,{className:"rounded-xl",spaceBetween:10,cssMode:!0,navigation:{enabled:!0},pagination:!0,mousewheel:!0,modules:[T,z,E],children:(w=s.listingAssets)==null?void 0:w.map(l=>l.format==="mp4"?e.jsx(t,{className:"h-72 rounded-xl",children:e.jsx(g,{className:"mx-auto h-72 w-full rounded-xl object-cover",cldImg:p.image(l.public_id).setAssetType("video").format("auto:image")})},l.public_id):l.format==="mp3"?e.jsx(t,{children:e.jsx("img",{className:"mx-auto h-72 w-full rounded-lg border object-cover",src:"https://png.pngtree.com/png-clipart/20230303/ourmid/pngtree-vinyl-records-png-image_6629914.png",alt:"some image",loading:"lazy"})},l.public_id):e.jsx(t,{children:e.jsx(g,{cldImg:p.image(l.public_id),plugins:[R(),U({steps:[800,1e3,1400]})],className:"mx-auto h-72 w-full rounded-lg border object-cover"},l._id)},l.public_id))},o)})}),e.jsxs($,{className:"mt-2 flex justify-between p-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold",children:s.serviceTitle}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:(y=s.host)==null?void 0:y.username}),e.jsx("div",{className:"w-full",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Ends in"," ",O(new Date().setHours(0,0,0,0),new Date(s.endsAt))]})}),e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("span",{className:"font-semibold",children:[B({value:s.price.toString(),intlConfig:{locale:"ph-PH",currency:"PHP"}})," ",e.jsx("span",{className:"text-sm font-semibold",children:"service"})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs font-bold",children:s.host.rating.length>0?(s.host.rating.map(l=>l.guestRating).reduce((l,j)=>l+j,0)/s.host.rating.length).toFixed(1):"No rating"})]}),((v=s.host)==null?void 0:v.uid)!==((_=n.currentUser)==null?void 0:_.uid)&&e.jsx(e.Fragment,{children:e.jsx(q,{listingID:s._id})})]})]})]},s._id):e.jsxs(H,{className:"w-full overflow-hidden border-none shadow-none",children:[e.jsx(A,{className:"flex flex-col gap-1 p-0",children:e.jsx(L,{to:`${((P=n.currentUser)==null?void 0:P.uid)===((I=s.host)==null?void 0:I.uid)?`/hosting-listings/edit/${s._id}`:`/listings/show/${s._id}`} `,className:"mt-2",replace:!0,children:e.jsx(M,{className:"rounded-xl",spaceBetween:10,cssMode:!0,navigation:{enabled:!0},pagination:!0,mousewheel:!0,modules:[T,z,E],children:(D=s.listingAssets)==null?void 0:D.map(l=>l.format==="mp4"?e.jsx(t,{className:"h-72 rounded-xl",children:e.jsx(g,{className:"mx-auto h-72 w-full rounded-xl object-cover",cldImg:p.image(l.public_id).setAssetType("video").format("auto:image")})},l.public_id):l.format==="mp3"?e.jsx(t,{children:e.jsx("img",{className:"mx-auto h-72 w-full rounded-lg border object-cover",src:"https://png.pngtree.com/png-clipart/20230303/ourmid/pngtree-vinyl-records-png-image_6629914.png",alt:"some image",loading:"lazy"})},l.public_id):e.jsx(t,{children:e.jsx(g,{cldImg:p.image(l.public_id),plugins:[R(),U({steps:[800,1e3,1400]})],className:"mx-auto h-72 w-full rounded-lg border object-cover"},l._id)},l.public_id))},o)})}),e.jsxs($,{className:"mt-2 flex justify-between p-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold",children:s.serviceTitle}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:(C=s.host)==null?void 0:C.username}),e.jsx("div",{className:"w-full",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Ends in"," ",O(new Date().setHours(0,0,0,0),new Date(s.endsAt))]})}),e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("span",{className:"font-semibold",children:[B({value:s.price.toString(),intlConfig:{locale:"ph-PH",currency:"PHP"}})," ",e.jsx("span",{className:"text-sm font-semibold",children:"service"})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs font-bold",children:s.host.rating.length>0?(s.host.rating.map(l=>l.guestRating).reduce((l,j)=>l+j,0)/s.host.rating.length).toFixed(1):"No rating"})]}),((k=s.host)==null?void 0:k.uid)!==((F=n.currentUser)==null?void 0:F.uid)&&e.jsx(e.Fragment,{children:e.jsx(q,{listingID:s._id})})]})]})]},s._id)})})}):e.jsxs("div",{className:"mt-16 flex flex-col items-center justify-center",children:[e.jsx(te,{loop:!1,animationData:ne,className:"h-64 w-64"}),e.jsx("span",{className:"text-xl font-bold text-gray-600",children:"No listings to show"})]}),d&&e.jsx("div",{className:"mx-auto w-max p-8",children:e.jsx("l-dot-pulse",{size:"43",speed:"1.3",color:"black"})}),r&&e.jsx("div",{className:"mx-auto w-max p-8",children:e.jsx(re,{children:r.response.data.message})})]})]})}export{xe as default};
