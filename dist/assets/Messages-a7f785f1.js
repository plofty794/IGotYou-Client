import{j as i,K as p,k as e}from"./index-d5eb7ded.js";import{ah as f,j as m,a6 as j,ab as g,ae as x,ac as b,ad as u,A as n,E as l,af as w,C as N,f as I,g as D,a9 as F,B as U}from"./App-a8cd9264.js";function C(){var d,r;return f({queryKey:["messages",(d=m.currentUser)==null?void 0:d.uid],queryFn:async({pageParam:c})=>await j.get(`/api/users/current-user/messages/${c}`),enabled:((r=m.currentUser)==null?void 0:r.uid)!=null,initialPageParam:1,getNextPageParam:(c,o)=>o.length+1})}function k(){const{data:d}=C(),{socket:r}=i.useContext(p),[c,o]=i.useState("");i.useEffect(()=>{document.title="Messages - IGotYou"},[]);function h(t,s){var a;t&&(r==null||r.emit("chat-message",{message:t,receiverName:s,senderName:(a=m.currentUser)==null?void 0:a.displayName}),o(""))}return i.useMemo(()=>{r==null||r.on("receive-message",t=>console.log(t.message))},[r]),e.jsxs("section",{className:"w-full",children:[e.jsx("h1",{className:"font-bold text-3xl mx-6 mt-4",children:"Messages"}),d==null?void 0:d.pages.map(t=>t.data.messages.map(s=>e.jsxs(g,{defaultValue:"account",className:"flex gap-2 w-full p-6",children:[e.jsx(x,{className:"h-max w-1/3 h-",children:e.jsx(b,{className:"w-full h-max flex-col",children:t.data.currentUserID===s.senderID._id?e.jsx(u,{className:"w-full",value:s.senderID.username,children:e.jsxs("div",{className:"flex items-center gap-2 w-full h-max p-2",children:[e.jsx(n,{className:" h-12 w-12",children:e.jsx(l,{className:"object-cover",src:s.receiverID.photoUrl??"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.slotcharter.net%2Fwp-content%2Fuploads%2F2020%2F02%2Fno-avatar.png&f=1&nofb=1&ipt=9e90fdb80f5dc7485d14a9754e5441d7fbcadb4db1a76173bf266e3acd9b3369&ipo=images"})}),e.jsx("span",{className:"font-bold text-sm",children:s.receiverID.username})]})},s._id):e.jsx(u,{className:"w-full",value:s.receiverID.username,children:e.jsxs("div",{className:"flex items-center gap-2 w-full h-max p-2",children:[e.jsx(n,{className:" h-12 w-12",children:e.jsx(l,{className:"object-cover",src:s.senderID.photoUrl??"https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.slotcharter.net%2Fwp-content%2Fuploads%2F2020%2F02%2Fno-avatar.png&f=1&nofb=1&ipt=9e90fdb80f5dc7485d14a9754e5441d7fbcadb4db1a76173bf266e3acd9b3369&ipo=images"})}),e.jsx("span",{className:"font-bold text-sm",children:s.senderID.username})]})},s._id)})}),e.jsx(w,{className:"m-0 w-full h-[60vh]",value:t.data.currentUserID===s.senderID._id?s.senderID.username:s.receiverID.username,children:e.jsxs(N,{className:"relative h-full",children:[e.jsx(x,{className:"h-5/6",children:e.jsx(I,{className:"w-full pt-4",children:t.data.currentUserID===s.senderID._id?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-max ml-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.senderID.photoUrl})}),e.jsxs("span",{className:"font-bold ",children:[" ",s.content," "]})]}),s.replies.length>0&&s.replies.map(a=>a.senderID===t.data.currentUserID?e.jsxs("div",{className:"w-max ml-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.senderID.photoUrl})}),e.jsxs("span",{className:"font-bold",children:[" ",a.content," "]})]},a._id):e.jsxs("div",{className:"bg-[#00B6AC] w-max mr-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.receiverID.photoUrl})}),e.jsxs("span",{className:"font-bold text-white",children:[" ",a.content," "]})]},a._id))]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#00B6AC] w-max mr-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.senderID.photoUrl})}),e.jsxs("span",{className:"font-bold text-white",children:[" ",s.content," "]})]}),s.replies.length>0&&s.replies.map(a=>a.senderID===s.receiverID._id?e.jsxs("div",{className:" w-max ml-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.receiverID.photoUrl})}),e.jsxs("span",{className:"font-bold ",children:[" ",a.content," "]})]},a._id):e.jsxs("div",{className:"bg-[#00B6AC] w-max mr-auto border shadow-md rounded-md p-2 flex items-center gap-2",children:[e.jsx(n,{children:e.jsx(l,{src:s.senderID.photoUrl})}),e.jsxs("span",{className:"font-bold text-white text-sm",children:[" ",a.content," "]})]},a._id))]})})}),e.jsxs(D,{className:"gap-2 p-2 bg-zinc-200 absolute bottom-0 w-full",children:[e.jsx(F,{autoFocus:!0,className:"min-h-[38px] text-sm font-semibold py-2 bg-white rounded-full",value:c,onChange:a=>o(a.target.value)}),e.jsx(U,{onClick:()=>h(c,s.receiverName),size:"lg",className:"bg-gray-950 rounded-full p-6 ",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"white",viewBox:"0 0 24 24",strokeWidth:1,stroke:"black",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})})})]})]})})]},s._id)))]})}export{k as default};
